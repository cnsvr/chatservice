<!DOCTYPE html>
<html lang="en">
<head th:replace="~{fragments/header :: header}"><title>NABER</title></head>

<body>
<!-- Begin page -->
<div class="wrapper">

    <!-- ========== Topbar Start ========== -->
    <div th:replace="~{fragments/layout :: topbar}"></div>
    <!-- ========== Topbar End ========== -->

    <!-- ========== Left Sidebar Start ========== -->
    <div th:replace="~{fragments/layout :: sidebar}"></div>
    <!-- ========== Left Sidebar End ========== -->

    <div class="content-page">
        <div class="content">
            <!-- Start Content-->
            <div class="container-fluid">
            </div>
            <!-- container -->
        </div>
    </div>
    <!-- content -->

    <!-- Footer Start -->
    <div th:replace="~{fragments/layout :: footer}"></div>
    <!-- end Footer -->
</div>
</body>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>

<script th:inline="javascript">
    // Connect to WebSocket Server.
    const protocol = window.location.protocol;
    const url = window.location.host;

    const socket = new SockJS(protocol + '//' + url + '/chat');
    const client = Stomp.over(socket);

    client.connect({}, onConnected, onError);

    function onConnected() {
        // Subscribe to the Public Topic
        console.log('Connected to WebSocket');

        client.subscribe('/topic/1', onMessageReceived);

        const sendMessageRequest = {
            channelID: '1',
            content: 'Hello, World!',
        }
        // Send a message to the server
        client.send("/app/send-message",
            {},
            JSON.stringify(sendMessageRequest)
        );
    }

    function onError(error) {
        console.log('Error: ' + error);
    }

    function onMessageReceived(payload) {
        console.log('Received message: ' + payload);
    }

</script>
</html>